{%extends 'content_smsapp/layout.html'%}




{%block pageContent%}
<div class="f">
  <div class="c3 s12">
    {%for key, value in myLinks%}
      <a class="cbox mB5" href="{{url.that}}?level={{key}}">
        <div class="f">
            <div class="cauto mRa5">{%if requestGET.level == key%}<i class="sf-arrow-left fc-blue"></i>{%endif%}</div>
            <div class="c {%if requestGET.level == key%}txtB{%else%}fc-mute{%endif%}">{{value.title}}</div>
            <div class="cauto"><span class="badge rounded {%if requestGET.level == key%}primary2{%else%}light{%endif%}">{{value.count | fitNumber}}</span></div>
        </div>
      </a>
    {%endfor%}

    <div class="cbox">
      <div class="f" data-confirm data-data='{"status" : "change"}'>
        <div class="mB10 c6">{%trans "System status"%}</div>
        <div class="c"></div>
        <div class="cauto">{% if sysStatus %} {%trans "On"%} {%else%} {%trans "Off"%} {%endif%}</div>

        <div class="c6" title='{{statusCount.lastconnected | date | dt}}'> {%trans "Last connection"%} </div>
        <div class="c"></div>
        <div class="txtB cauto"> {{statusCount.lastconnected | date | dt('human', 'year')}}</div>
      </div>
    </div>

  </div>
  <div class="c9 s12">
    <div class="mLa5">

    {{block('htmlSearchBox')}}
    {{block('htmlTable')}}
    </div>
  </div>
</div>

{%if dataTable and dataFilter%}
  {{block('htmlFilter')}}
{%endif%}


{%endblock%}





{%block iKerkere%}

<div class="advanceSearch" {%if requestGET.place or requestGET.startdate or requestGET.enddate %} {%else%}data-kerkere-content='hide' {%endif%}>
  <h6 class="mT10">{%trans "Filter by start date and end date of sms"%}</h6>
  <div class="f">

     <div class="cauto s12 mB5 pRa5">
      <div class="input ltr">
        <input class="datepicker" type="text" name="startdate" title='{%trans "Start date"%}' placeholder='{%trans "Start date"%}' id="startdate"  value="{{startdateEn}}" maxlength='20' data-format="YYYYMMDD"data-view="day">
      </div>
    </div>

    <div class="cauto s12 mB5 pRa5">
      <div class="input ltr">
        <input class="datepicker" type="text" name="enddate" title='{%trans "End date"%}' placeholder='{%trans "End date"%}' id="enddate"  value="{{enddateEn}}" maxlength='20' data-format="YYYYMMDD"data-view="day">
      </div>
    </div>

  </div>

  <h6 class="mT10">{%trans "Filter by group"%}</h6>
  <div class="f ">
    {%for key, value in allGroupList%}
    <div class="c3 s6">
      <div class="radio3 mB5">
        <input type="radio" name="group_id" value="{{value.id}}" id="group_id{{value.id}}" {%if requestGET.group_id == value.id %} checked {%endif%}>
        <label for="group_id{{value.id}}">{{value.title}}</label>
      </div>
    </div>
    {%endfor%}
  </div>


  <a class="btn" href="{{url.this}}">{%trans "Clear filter"%}</a>
  <button class="btn primary2">{%trans "Apply"%}</button>

</div>
{%endblock%}


{%block htmlSearchBox%}
    <div class="cbox fs12">
<div class="f">
  <div class="c">
      <form method="get" action='{{url.that}}' autocomplete="off">
        <div class="input">
          <label class="addon" data-kerkere='.advanceSearch' data-kerkere-icon>{%trans "Advance"%}</label>
          <input type="search" name="q" placeholder='{%trans "Search"%}' id="q" value="{{requestGET.q}}" class="" data-default data-pass='submit' autocomplete='off'>
          <button class="addon btn "><i class="sf-search"></i></button>

        </div>
        {{block('iKerkere')}}
      </form>
    </div>

  </div>
</div>
{%endblock%}


{%block htmlTable%}

      {%for key, value in dataTable%}
      <div class="cbox mA5-f">
        <a href="{{url.this}}/view?mobile={{value.fromnumber}}">
          <div class="f">
            <div class="cauto">
              <img class="avatar" src="https://khadije.com/static/siftal/images/default/avatar.png">
            </div>
            <div class="cauto fc-black txtB"> {{value.displayname}}</div>
            <div class="c fc-black txtB"> {{value.fromnumber | fitNumber('mobile')}}</div>
            <div class="cauto fc-black ltr txtL">{{value.lastdate | dt}}</div>
          </div>
          <div class="f">
            <div class="c fc-black fc-mute"> {{value.lastmessage}}</div>
            <div class="cauto fc-black"><span class="badge rounded primary">{{value.count | fitNumber}}</span></div>
          </div>
        </a>
      </div>
      {%endfor%}







<div class="tblBox hide">

  <table class="tbl1 v6 responsive">
    <thead class="s0">
      <tr class="fs08">
        <th>{%trans "Sms text"%}</th>
        <th></th>
        <th>{%trans "Answer"%}</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      {%for key, value in dataTable%}
      <tr class="{%if value.receivestatus == 'awaiting' %} active {%endif%}">
        <td>
          <a href="{{url.here}}/viewsms?id={{value.id}}">
            <span class="badge primary">{%trans "Detail"%}</span>
          </a>

          {%if value.sendstatus == 'waitingtoautosend'%}
          <span data-confirm data-data='{"skip" : "skip", "id" : "{{value.id}}"}'>
            <span class="badge warn">{%trans "Skip"%}</span>
          </span>
          {%endif%}

          {% if value.group_type == 'family' %}
            <small class="fc-mute">{%trans "Private"%}</small>
          {%else%}
            {{value.text | slice(0, 150) |raw | nl2br }}
          {%endif%}
        </td>
        <td class="collapsing">
          <div>{{value.datecreated | dt('human', 'year')}}</div>
          <div class="ltr">{{value.datecreated | dt}}</div>
          <div>-----</div>
          <div>
            {%trans "fromnumber"%}
            <a href="{{url.that}}?fromnumber={{value.fromnumber}}">{{value.fromnumber | fitNumber(false)}}</a>
          </div>

            {%if value.togateway%}
            <div>{%trans "togateway"%} <a href="{{url.that}}?togateway={{value.togateway}}" {%if value.togateway == '989127522690' %}class='compact badge light'{%endif%}>{{value.togateway | fitNumber(false)}}</a></div>
            {%endif%}

            {%if value.fromgateway%}
            <div>-----</div>
            <div>{%trans "fromgateway"%} <a href="{{url.that}}?fromgateway={{value.fromgateway}}">{{value.fromgateway | fitNumber(false)}}</a></div>
            {%endif%}
            {%if value.tonumber%}
            <div>{%trans "tonumber"%} <a href="{{url.that}}?tonumber={{value.tonumber}}">{{value.tonumber | fitNumber(false)}}</a></div>
            {%endif%}
        </td>


        <td>{{value.answertext | raw | nl2br}}

          <div class="ltr fc-mute">{{value.dateanswer | dt}}</div>
        </td>

        <td class="collapsing">
          {%if value.receivestatus %}<div> {%trans "Receive status"%} <a href="{{url.that}}?receivestatus={{value.receivestatus}}">{{value.treceivestatus}}</a></div>{%endif%}
          {%if value.sendstatus%}<div> {%trans "Send status"%} <a href="{{url.that}}?sendstatus={{value.sendstatus}}">{%set mysendstatus = value.sendstatus%}{%trans mysendstatus%}</a></div>{%endif%}
          {%if not value.sendstatus and requestGET.recommend == 'yes'%}
            <div  class="btn xs warn2" data-confirm data-data='{"recommend": "invalid", "id": "{{value.id}}"}'>{%trans "Send to analyze"%}</div>
          {%endif%}

        {%if value.group_id%}<div> {%trans "Group"%} <a href="{{url.that}}?group_id={{value.group_id}}">{{value.group_title}}</a></div>{%endif%}
        <div>
          {%if value.recommend_id%}<div> {%trans "Recommend"%} <a href="{{url.that}}?recommend_id={{value.recommend_id}}">{{value.recommend_title}}</a></div>{%endif%}
          {%if value.receivestatus == 'awaiting' %}
            <div class="check1">
              <input type="checkbox" name="archive_id[]" value="{{value.id}}" id="iacr{{value.id}}">
              <label for="iacr{{value.id}}">{%trans "Archive"%}</label>
            </div>
            {% if false%}
              <div class="btn xs danger" data-confirm data-data='{"skip": "skip", "id": "{{value.id}}"}'>{%trans "Archive"%}</div>
            {%endif%}
          {%endif%}
          <div></div>
        </td>
      </tr>
      {%endfor%}
    </tbody>
  </table>
</div>
</form>
  {%include display.pagination%}

{%endblock%}


{%block htmlFilter%}
<p class="f fs14 msg warn2">
  <span class="c">{{dataFilter | raw }}</span>
  <a class="cauto" href="{{url.that}}">{%trans "Clear filters"%}</a>
</p>
{%endblock%}


{%block htmlFilterNoResult%}
<p class="f fs14 msg warn2">
  <span class="c">{%trans "Result not found!"%} {%trans "Search with new keywords."%}</span>
  <a class="cauto" href="{{url.that}}">{%trans "Clear filters"%}</a>
</p>
{%endblock%}


{%block htmlStartAddNew%}
<p class="fs14 msg success2 pTB20">{%trans "No record exist!"%}</p>
{%endblock%}





