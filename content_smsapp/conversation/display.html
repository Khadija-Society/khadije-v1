{%extends 'content_smsapp/layout.html'%}

{%block pageContent%}
<div class="f">
  <div class="c3 s12">
    {{block('iPoof')}}
  </div>
  <div class="c9 s12">
    <div class="mLa5">
      {{block('htmlTable')}}
    </div>
  </div>
</div>
{%if dataTable and dataFilter%}
  {{block('htmlFilter')}}
{%endif%}
{%endblock%}




{%block iPoof%}
{%for key, value in myLinks%}
{%set isActive = false%}{% if requestGET.level == key %}{%set isActive = true%}{%elseif  value.default and not requestGET.level%}{%set isActive = true%}{%endif%}
  <a class="cbox mB5" href="{{url.that}}?level={{key}}">
    <div class="f">
        <div class="cauto mRa5">{%if isActive%}<i class="sf-arrow-left fc-blue"></i>{%endif%}</div>
        <div class="c {%if isActive%}txtB{%else%}fc-mute{%endif%}">{{value.title}}</div>
        <div class="cauto"><span class="badge rounded {%if isActive%}primary2{%else%}light{%endif%}" id="count_{{key}}">{{value.count | fitNumber}}</span></div>
    </div>
  </a>
{%endfor%}
<div class="cbox mTB10">
  <div class="f" data-confirm data-data='{"status" : "change"}'>
    <div class="mB10 c6">{%trans "System status"%}</div>
    <div class="c"></div>
    <div class="cauto">{% if sysStatus %} <b class="fc-green">{%trans "On"%}</b> {%else%} <b class="fc-red">{%trans "Off"%}</b> {%endif%}</div>
    <div class="c6" title='{{lastConnected | date | dt}}'> {%trans "Last connection"%} </div>
    <div class="c"></div>
    <div class="txtB cauto"> {{lastConnected | date | dt('human', 'year')}}</div>
  </div>
</div>
<div class="cbox fs12">
<div class="f">
  <div class="c">
      <form method="get" action='{{url.that}}' autocomplete="off">
        {%if requestGET.level%}<input type="hidden" name="level" value="{{requestGET.level}}">{%endif%}
        <div class="input">
          <input type="search" name="q" placeholder='{%trans "Search"%}' id="q" value="{{requestGET.q}}" class="" data-default data-pass='submit' autocomplete='off'>
          <button class="addon btn "><i class="sf-search"></i></button>
        </div>
      <h6 class="mT10">{%trans "Filter by start date and end date of sms"%}</h6>
      <div class="f mB10">
         <div class="c6 s12 ">
          <div class="input ltr pRa5">
            <input class="datepicker" type="text" name="startdate" title='{%trans "Start date"%}' placeholder='{%trans "Start date"%}' id="startdate"  value="{{startdateEn}}" maxlength='20' data-format="YYYYMMDD"data-view="day">
          </div>
        </div>
        <div class="c6 s12 ">
          <div class="input ltr">
            <input class="datepicker" type="text" name="enddate" title='{%trans "End date"%}' placeholder='{%trans "End date"%}' id="enddate"  value="{{enddateEn}}" maxlength='20' data-format="YYYYMMDD"data-view="day">
          </div>
        </div>
      </div>
      <div class="txtRa">
        {%if requestGET%}
          <a class="btn" href="{{url.this}}">{%trans "Clear filter"%}</a>
        {%endif%}
        <button class="btn primary2">{%trans "Apply"%}</button>
      </div>
      </form>
    </div>
  </div>
</div>
{%endblock%}



{%block htmlTable%}
{%if dataTable%}
  {%for key, value in dataTable%}
  <div class="cbox mB5-f">
    <a href="{{url.this}}/view?mobile={{value.fromnumber}}">
      <div class="f">
        <div class="cauto">
          <img class="avatar" src="{{value.avatar}}" alt="{{value.displayname}}">
        </div>
        <div class="cauto fc-black txtB"> {{value.displayname}}</div>
        <div class="c fc-black txtB"> {{value.fromnumber | fitNumber('mobile')}}</div>
        <div class="cauto fc-black">

          <span class="badge rounded primary">{{value.count | fitNumber}}</span>
          <span class="ltr txtL"> {{value.lastdate | dt}}</span>

        </div>
      </div>
      <div class="f">
        <div class="c fc-mute">{%if value.lastmessage == 'secret message' %}<i>{%trans "Private"%}</i>{%else%}{{value.lastmessage}}{%endif%} </div>
      </div>
    </a>
  </div>
  {%endfor%}
{%endif%}
{%include display.pagination_np%}
{%endblock%}


{%block htmlFilter%}
<p class="f fs14 msg warn2">
  <span class="c">{{dataFilter | raw }}</span>
  <a class="cauto" href="{{url.that}}">{%trans "Clear filters"%}</a>
</p>
{%endblock%}


{%block foot_js%}
<script type="text/javascript">
  function chartDrawer()
  {
    fetch('{{url.this}}?calc=all').then(function(response) {return response.json()}).then(function(data){$("#count_all").text(fitNumber(data.all)); $("#count_awaiting").text(fitNumber(data.awaiting));});
  }



</script>
{%endblock%}